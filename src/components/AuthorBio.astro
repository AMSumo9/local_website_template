---
// src/components/AuthorBio.astro
import { Image } from 'astro:assets';
import defaultAvatar from '../assets/images/locations/default.png';

export interface Props {
  persona: {
    expert_name: string;
    expert_title: string;
    expert_bio: string;
    trust_badges: string[];
    expert_image?: string; // <-- 1. Make this prop available
  };
}

const { persona } = Astro.props;

// --- 2. Smart Image Loading Logic ---
// Get all possible persona images
const allPersonaImages = await Astro.glob('/src/assets/images/persona/*.{jpeg,jpg,png,webp}');

// Find the specific image mentioned in project.json
const matchedImage = allPersonaImages.find(img => 
  img.default.src.endsWith(persona.expert_image)
);

// Use the matched image, or fall back to the default avatar
const expertImage = matchedImage ? matchedImage.default : defaultAvatar;
---

<div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mt-12">
  <h3 class="text-2xl font-bold text-[var(--text-primary)] mb-4">
    About the Author
  </h3>
  <div class="flex flex-col sm:flex-row sm:items-center gap-6">
    <div class="flex-shrink-0">
      <Image 
        src={expertImage} 
        alt={persona.expert_name} 
        class="rounded-full w-24 h-24 object-cover mx-auto sm:mx-0"
        width="96"
        height="96"
      />
    </div>
    <div>
      <p class="text-xl font-semibold text-[var(--text-primary)]">
        {persona.expert_name}
      </p>
      <p class="text-base text-brand-primary font-medium">
        {persona.expert_title}
      </p>
      <p class="text-[var(--text-secondary)] mt-2">
        {persona.expert_bio}
      </p>
      
      {persona.trust_badges && persona.trust_badges.length > 0 && (
        <div class="flex flex-wrap gap-x-4 gap-y-2 mt-4">
          {persona.trust_badges.map(badge => (
            <span class="text-sm font-medium text-gray-600">
              <i class="fas fa-check-circle text-brand-primary mr-1"></i>
              {badge}
            </span>
          ))}
        </div>
      )}
      
      <a href="/about/" class="font-semibold text-brand-primary hover:text-brand-primary-dark mt-4 inline-block">
        Learn more about our team &rarr;
      </a>
    </div>
  </div>
</div>